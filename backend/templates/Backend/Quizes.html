
<!DOCTYPE HTML>
<html>
<head>  
        <meta charset="UTF-8">
        <!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services --> 
        <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-database.js"></script>
        <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
        <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-analytics.js"></script>    
        <!-- Add Firebase products that you want to use -->
        <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-firestore.js"></script>
        <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

        <script type="text/javascript" src="/static/scripts/script.js"></script>
        <link href="/static/css/main.css" rel="stylesheet" type="text/css"/>

    </head>
</head>
<header>
  <div id="nav-placeholder">

  </div>
  
  <script>
  $(function(){
    $("#nav-placeholder").load("nav");
  });
  </script></header>

<body>
<div class="container">
<h1 id="titleQ">עריכת חידות</h1>
<br>
    <div id="qui"> 
        <script>
        const queryString = window.location.search;
        var NumOfSite =queryString.substring(1);
        titleQ.innerHTML="עריכת חידות עבור אתר "+NumOfSite;
        var database = firebase.database().ref('Quizes')
        var NumOfQuiz=0
    database.on('value', (dataSnapshot) => {
     dataSnapshot.forEach((child) => {
        
    if (child.val().numberOfSite == NumOfSite ){
        
      console.log(child.val().QuizeContent)
      QuizeID = child.val().QuizeID
      NumOfQuiz=NumOfQuiz+1
      qui.innerHTML= qui.innerHTML+"<div class='All'><p calss='Q'>"+"<h2>שאלה "+NumOfQuiz+"</h2><textarea style='width:95%; height:70px' id='quizContent"+QuizeID+"'>"+child.val().QuizeContent+"</textarea></p>"
      +"<p class='A'>"+"תשובה 1: "+"<br><textarea style='width:95%; height:20px' id='Answer1"+QuizeID+"'>"+child.val().Answer1+"</textarea></p>"+
      "<p class='A'>"+"תשובה 2: "+"<br><textarea style='width:95%; height:20px' id='Answer2"+QuizeID+"'>"+child.val().Answer2+"</textarea></p>"+
      "<p class='A'>"+"תשובה 3: "+"<br><textarea style='width:95%; height:20px' id='Answer3"+QuizeID+"'>"+child.val().Answer3+"</textarea></p>"+
      "<p class='A'>"+"תשובה 4: "+"<br><textarea style='width:95%; height:20px' id='Answer4"+QuizeID+"'>"+child.val().Answer4+"</textarea></p>"+
      "<p class='c'>"+"התשובה הנכונה: "+"<br><textarea style='width:95%; height:20px'  id='RightAnswerNum"+QuizeID+"'>"+child.val().RightAnswerNum+"</textarea></p>"+
     "<p clss='but'> <button  onclick='update("+QuizeID+","+NumOfSite+")'>עדכן חידה</button> <button onclick='deleteQ("+QuizeID+")'>מחק חידה</button></p>"+
     "</div><br><br>"
    }
  })
})
    

    function update(QuizeID,NumOfSite){
        // debugger;
        var numberOfSite = NumOfSite;      
        var quizContent = document.getElementById("quizContent"+QuizeID+"").value;
        var Answer1 = document.getElementById("Answer1"+QuizeID+"").value;
        var Answer2 = document.getElementById("Answer2"+QuizeID+"").value;
        var Answer3 = document.getElementById("Answer3"+QuizeID+"").value;
        var Answer4 = document.getElementById("Answer4"+QuizeID+"").value;
        var RightAnswerNum = document.getElementById("RightAnswerNum"+QuizeID+"").value;
        tal = (Answer4!="" && Answer3!=""&&Answer2!=""&&Answer1!=""&&quizContent!="")
        checkNum= (RightAnswerNum=="1"||RightAnswerNum=="2"||RightAnswerNum=="3"||RightAnswerNum=="4")
        if(tal&&checkNum){
        firebase.database().ref('/Quizes/' + QuizeID ).set({
            QuizeID:QuizeID,
            numberOfSite:numberOfSite,
            QuizeContent:quizContent,
            Answer1:Answer1,
            Answer2:Answer2,
            Answer3:Answer3,
            Answer4:Answer4,
            RightAnswerNum:3
        }).then(function onSuccess(res) {
    window.location.href = "Quizes.html?"+NumOfSite;
  })
    alert('החידה עודכנה בהצלחה');
    }
    else if(checkNum==false){
        alert('יש למלא תשובה נכונה לחידה עם מספרים 1-4 בלבד');
    }
    else{
        alert('יש למלא את כל השדות של השאלה כדי לעדכן');
    }
    }

    function deleteQ(QuizeID){
        // debugger;
        var DQ=firebase.database().ref('/Quizes/' + QuizeID );

        DQ.remove()
   
    alert('החידה נמחקה  מהנתונים');
    window.location.reload();

    }
        </script> 

    </div>
</div>
</body>
</html>